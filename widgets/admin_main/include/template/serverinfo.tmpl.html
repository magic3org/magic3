/**
 * 表示データ作成用テンプレート(patTemplate)
 *
 * LICENSE: This source file is licensed under the terms of the GNU General Public License.
 *
 * @package    Magic3 Framework
 * @author     平田直毅(Naoki Hirata) <naoki@aplo.co.jp>
 * @copyright  Copyright 2006-2015 Magic3 Project.
 * @license    http://www.gnu.org/copyleft/gpl.html  GPL License
 * @version    SVN: $Id$
 * @link       http://www.magic3.org
 */
<patTemplate:tmpl name="_widget">
<script type="text/javascript">
//<![CDATA[
function updateSrc()
{
	// 確認ダイアログ表示
	m3Confirm('', 'インストーラを更新しますか?\n所要時間: 約5分', function(result){
		if (result){
			document.main.act.value='getnewsrc';
			document.main.submit();
			return true;
		}
	});
}
function watchProcess(){
	m3_ajax_request('', 'task=serverinfo&act=getinfo', function(request, retcode, jsondata){		// 正常終了
		if (jsondata.code == '0'){			// 処理中の場合
			watchProcess();
		} else {		// 処理完了の場合
			// 処理中ダイアログを非表示
			m3HideProcessModal();
			
			m3Alert('success', 'インストーラの更新完了しました', function(){
				// 画面再表示
				window.location.href = window.location.href;
			});
		}
	}, function(request){		// 異常終了
		m3Alert("error", "インストーラの更新に失敗しました");
	});
}
function startWatchProcess()
{
	// 処理中ダイアログ表示
	m3ShowProcessModal();
	
	// サーバ処理監視
	watchProcess();
}
$(function(){
	m3SetConfigTable('server_info');
	m3SetConfigTable('site_admin_info');
	m3SetConfigTable('install_info');
<patTemplate:tmpl name="show_process_dialog" visibility="hidden">
	// 処理結果監視を開始
	startWatchProcess();
</patTemplate:tmpl>
});
//]]>
</script>
<div class="m3config_container">
<!-- m3:ErrorMessage -->
<form method="post" name="main">
<input type="hidden" name="act" />
<h3>サーバ情報</h3>
<table id="server_info">
    <tbody>
	<tr><th>URL</th><td colspan="2">{SITE_URL}</td></tr>
	<tr><th>SSL期限</th><td colspan="2">{SSL_EXPIRE_DT}{DOMAIN_NAME}</td></tr>
	<tr><th>ホストID</th><td colspan="2">{HOST_ID}</td></tr>
    <tr><th rowspan="4">ディスク</th><th>全体サイズ</th><td>{TOTAL_SIZE}</td></tr>
	<tr><th>空き容量</th><td>{FREE_SIZE}</td></tr>
	<tr><th>使用容量</th><td>{USED_SIZE}</td></tr>
	<tr><th>使用率</th><td>{USED_RATE}</td></tr>
    </tbody>
</table>
<h3>サイト管理</h3>
<table id="site_admin_info">
    <tbody>
    <tr><th>ジョブ監視</th><td>{WATCH_JOB_STATUS}</td></tr>
    </tbody>
</table>
<h3>サイト構築</h3>
<table id="install_info">
    <tbody>
    <tr><th>インストーラ<br />バージョン</th><td>{SRC_VERSION}<div class="pull-right"><input type="button" class="button" onclick="updateSrc();" value="最新版を取得" {UPDATE_SRC_BUTTON_DISABLED} /></div></td></tr>
    </tbody>
</table>
</form>
</div>
</patTemplate:tmpl>
