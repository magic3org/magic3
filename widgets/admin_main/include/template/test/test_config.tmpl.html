/**
 * 表示データ作成用テンプレート(patTemplate)
 *
 * LICENSE: This source file is licensed under the terms of the GNU General Public License.
 *
 * @package    Magic3 Framework
 * @author     平田直毅(Naoki Hirata) <naoki@aplo.co.jp>
 * @copyright  Copyright 2006-2015 Magic3 Project.
 * @license    http://www.gnu.org/copyleft/gpl.html  GPL License
 * @version    SVN: $Id$
 * @link       http://www.magic3.org
 */
<patTemplate:tmpl name="_widget">
<script type="text/javascript">
//<![CDATA[
function updateItem(){
	if (!window.confirm('設定を更新しますか?')) return false;
	document.main.act.value='update';
	document.main.submit();
	return true;
}
// ファイルブラウザ起動
function selectImage()
{
	m3OpenImageFileBrowser(SetUrl);
}
// ファイルブラウザからの設定用
function SetUrl(url)
{
	$('#item_html').insertAtCaret(url);
	
	alert(url);
/*	// URL設定
	$('#image_url').text(url);
	$('#item_image_url').val(url);
	
	// Flashの場合はデフォルトサイズを設定
	if ($('#item_type').val() == '1'){
		$('#image_width').val('130');
		$('#image_height').val('130');
	}
	
	// 画像表示
	updateImage();*/
}

$(function(){
	// CKEditorプラグイン直接実行
	m3LoadCKTools();
	
	m3SetConfigTable('config_table');
	
	// WYSIWYGエディター作成
//	m3SetWysiwygEditor('item_html', 200/* 高さ */);
	// 画像選択
	$("#selimage").click(function (){
		selectImage();
	});
	
	$('#item_html').insertAtCaret('input here!');
});
//]]>
</script>

<div class="m3config_container">
<!-- m3:ErrorMessage -->
<form method="post" name="main">
<input type="hidden" name="act" />
<input type="hidden" name="ticket" value="{TICKET}" />
<!--<h3><span {_HELP_UNTITLED_TEST}>ウィジェット設定画面テスト</span></h3>-->
<h3 class="m3config_h"><span {_HELP_EVENT_LIST}>受付イベント一覧</span>
<!--<a href="javascript:void(0);" class="btn btn-sm btn-warning" role="button" rel="m3help" data-container="body" title="記事を検索" onclick="showSearchArea();"><i class="glyphicon glyphicon-search"></i></a>-->
</h3>
<div class="m3config_h_side_buttons pull-right"><div {_HELP_EVENT_BUTTONS}><div class="btn-group">
<input type="button" class="button" onclick="selectEvent();" value="新規" /><input type="button" class="button" onclick="editItem();" value="編集" /><input type="button" class="button" onclick="delItem();" value="削除" />
</div></div></div>

<table id="config_table">
    <tbody>
	<tr>
	    <th><span {_HELP_ENTRY_ID}>イベントID</span></th>
	    <td style="width:200px;"><div class="form-control-static m3config_item col-sm-6">{EVENT_ID}</div><div class="pull-right">{EYECATCH_IMAGE}</div></td>
	    <th><span {_HELP_EVENT_STATUS}>受付状態</span></th>
	    <td id="status_field" class="warning">
		<div class="col-sm-6 m3config_item">
		<select id="item_status" name="item_status" class="form-control">
	        <patTemplate:tmpl name="status_list">
	        <option value="{VALUE}" {SELECTED}>{NAME}</option>
	        </patTemplate:tmpl>
	    </select>
		</div>
		</td>
	</tr>
	<tr>
	    <th><span {_HELP_ENTRY_NAME}>イベント名</span></th>
	    <td colspan="3"><i class="glyphicon glyphicon-question-sign text-warning" style="font-size:150%;"></i><div class="form-control-static m3config_item">{EVENT_NAME}</div></td>
	</tr>
    <tr>
	    <th><span {_HELP_EVENT_URL}>説明</span><div class="pull-right"><a id="selimage" href="javascript:void(0);" class="btn btn-sm btn-warning" role="button" data-container="body"><i class="glyphicon glyphicon-edit"></i></a></div></th>
	    <td class="ckeditor" colspan="3"><textarea id="item_html" name="item_html">{HTML}</textarea></td>
	</tr>
    </tbody>
</table>
<div class="well m3config_update_buttons"><input type="button" class="button" onclick="updateItem();" value="更新" /></div>
</form>
</div>
</patTemplate:tmpl>